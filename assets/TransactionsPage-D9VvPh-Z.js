const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/finance-CqPMwo_Z.js","assets/index-HX_wmsfL.js","assets/index-CuXPmcd3.css"])))=>i.map(i=>d[i]);
import{r as a,b as we,a as ke,j as e,L as Y,H as Z,c as Se,d as Ce,e as De,h as Ee,_ as ee}from"./index-HX_wmsfL.js";/* empty css                    */import{exportTransactionsCsv as Te,importTransactionsCsv as _e,fetchAccounts as Ae,fetchCategories as Fe,fetchTags as Re,fetchTransactionsPaged as Ie,createTransaction as Pe}from"./finance-CqPMwo_Z.js";import{g as Oe}from"./savings-D0MGCJf6.js";import{R as Le,A as Me,X as Be,T as He,a as se}from"./AreaChart-Ci19JBcu.js";function F(g){const j=typeof g=="string"?Number(g):g;return Number.isNaN(j)?g.toString():j.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function Ke(){const[g,j]=a.useState([]),[te,R]=a.useState([]),[I,ae]=a.useState([]),[ne,re]=a.useState([]),[b,le]=a.useState([]),[ie,oe]=a.useState([]),[P,O]=a.useState(!1),[m]=a.useState(20),[c,L]=a.useState(0),[x,ce]=a.useState(null),[de,M]=a.useState(!1),[B,p]=a.useState(null),[v,H]=a.useState(""),[C,me]=a.useState("EXPENSE"),[D,xe]=a.useState(""),[G,ue]=a.useState(new Date().toISOString().slice(0,10)),[E,X]=a.useState(""),[z,U]=a.useState(""),[f,y]=a.useState(""),[T,V]=a.useState(""),[K,$]=a.useState(!1),[q,W]=a.useState(!1),[h,N]=a.useState(null),_=a.useRef(null),[o]=we(),[w,ge]=a.useState([]),{range:l}=ke(),[pe,he]=a.useState(o.get("category")?Number(o.get("category")):""),[fe,je]=a.useState(o.get("kind")||""),[J,k]=a.useState(!1);async function be(){try{M(!0);const[s,t,n,r]=await Promise.all([Ae(),Fe(),Re(),Oe()]);ae(s),le(n),re(t),oe(r),s.length>0&&v===""&&H(s[0].id)}catch(s){console.error(s),p("Failed to load accounts/categories")}finally{M(!1)}}async function S(){try{O(!0),p(null);const s=await Ie({start:l.startDate,end:l.endDate,limit:m,offset:c}),t=s.results??s;j(t),ce(typeof s.count=="number"?s.count:null),Q(t,l.startDate,l.endDate,pe,fe)}catch(s){console.error(s),p("Failed to load transactions")}finally{O(!1)}}a.useEffect(()=>{async function s(){try{const{fetchAggregatedTransactions:t}=await ee(async()=>{const{fetchAggregatedTransactions:r}=await import("./finance-CqPMwo_Z.js");return{fetchAggregatedTransactions:r}},__vite__mapDeps([0,1,2])),n=await t({start:l.startDate,end:l.endDate,group_by:"day"});R(n.series&&n.series.length>0?n.series:ve(l.startDate,l.endDate))}catch(t){console.error(t)}}s()},[l.startDate,l.endDate]);function ve(s,t){const n=new Date(s),r=new Date(t),d=[];for(let i=new Date(n);i<=r;i.setDate(i.getDate()+1))d.push({date:i.toISOString().slice(0,10),income:0,expenses:0});return d}function Q(s,t,n,r,d){let i=s.slice();if(t){const u=new Date(t);i=i.filter(A=>new Date(A.date)>=u)}if(n){const u=new Date(n);i=i.filter(A=>new Date(A.date)<=u)}r&&(i=i.filter(u=>u.category===r)),d&&(i=i.filter(u=>u.kind===d)),ge(i)}a.useEffect(()=>{be(),S()},[]),a.useEffect(()=>{he(o.get("category")?Number(o.get("category")):""),je(o.get("kind")||""),Q(g,l.startDate,l.endDate,o.get("category")?Number(o.get("category")):"",o.get("kind")||"")},[o]),a.useEffect(()=>{S()},[c,l.startDate,l.endDate]);async function ye(s){if(s.preventDefault(),!(!v||!E))try{$(!0),p(null),await Pe({account:v,date:G,amount:Number(E),kind:C,category:D||null,description:z,tags:f,savings_goal:T||null}),X(""),U(""),y(""),V(""),k(!1),await S();try{const{fetchAggregatedTransactions:t}=await ee(async()=>{const{fetchAggregatedTransactions:r}=await import("./finance-CqPMwo_Z.js");return{fetchAggregatedTransactions:r}},__vite__mapDeps([0,1,2])),n=await t({start:l.startDate,end:l.endDate});R(n.series||[])}catch{}window.dispatchEvent(new Event("transactionsUpdated"))}catch(t){console.error(t),p("Failed to create transaction")}finally{$(!1)}}const Ne=ne.filter(s=>s.kind===C||s.kind==="EXPENSE"||s.kind==="INCOME");return e.jsxs("div",{className:"space-y-6 pb-20 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Transactions"}),e.jsx("p",{className:"text-base text-[var(--text-muted)] mt-1 font-medium",children:"Track your income and expenses"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{to:"/categories",className:"btn-secondary inline-flex items-center gap-2",children:[e.jsx(Z,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Manage Categories"}),e.jsx("span",{className:"sm:hidden",children:"Categories"})]}),e.jsxs("button",{onClick:()=>k(!J),className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(Se,{size:18}),e.jsx("span",{children:"Add"})]})]})]}),B&&e.jsx("div",{className:"card bg-red-50 border-red-200 text-red-700 text-sm p-4",children:B}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide",children:"Cashflow Overview"}),e.jsxs("div",{className:"text-xs text-[var(--text-muted)]",children:[l.startDate," â†’ ",l.endDate]})]}),e.jsx("div",{style:{width:"100%",height:120},children:e.jsx(Le,{width:"100%",height:120,children:e.jsxs(Me,{data:te,children:[e.jsx(Be,{dataKey:"date",hide:!0}),e.jsx(He,{formatter:s=>F(s)}),e.jsx(se,{type:"monotone",dataKey:"income",stroke:"#16A34A",fill:"#16A34A",fillOpacity:.2}),e.jsx(se,{type:"monotone",dataKey:"expenses",stroke:"#DC2626",fill:"#DC2626",fillOpacity:.2})]})})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>{const s=_.current;s&&s.click()},className:"card p-4 hover:shadow-lg transition-shadow text-left",children:[e.jsx(Ce,{size:24,className:"text-green-600 mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Import CSV"}),e.jsx("div",{className:"text-xs text-[var(--text-muted)]",children:"Upload file"})]}),e.jsxs("button",{onClick:async()=>{try{W(!0);const s=await Te({start:l.startDate,end:l.endDate}),t=window.URL.createObjectURL(new Blob([s])),n=document.createElement("a");n.href=t,n.download="transactions.csv",document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(t)}catch(s){p(s?.message||"Failed to export CSV")}finally{W(!1)}},disabled:q,className:"card p-4 hover:shadow-lg transition-shadow text-left disabled:opacity-50",children:[e.jsx(De,{size:24,className:"text-orange-600 mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Export CSV"}),e.jsx("div",{className:"text-xs text-[var(--text-muted)]",children:q?"Preparing...":"Download"})]}),e.jsxs(Y,{to:"/categories",className:"card p-4 hover:shadow-lg transition-shadow text-left col-span-2 sm:col-span-1",children:[e.jsx(Z,{size:24,className:"text-purple-600 mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Settings"}),e.jsx("div",{className:"text-xs text-[var(--text-muted)]",children:"Categories & Tags"})]})]}),e.jsx("input",{ref:_,type:"file",accept:"text/csv",className:"hidden",onChange:async()=>{const s=_.current?.files?.[0];if(!s){N({error:"Please select a CSV file first."});return}try{N(null);const t=await _e(s);N({success:t}),await S()}catch(t){N({error:t?.message||String(t)})}}}),h&&e.jsxs("div",{className:`card text-sm p-4 ${h.error?"bg-red-50 text-red-700":"bg-green-50 text-green-700"}`,children:[h.error&&`Error: ${String(h.error)}`,h.success&&`Successfully imported ${h.success.created??"transactions"}`]}),J&&e.jsxs("form",{onSubmit:ye,className:"neu-card space-y-4 animate-slide-in",children:[e.jsxs("div",{className:"neu-header",children:[e.jsx("h4",{className:"neu-title",children:"Add New Transaction"}),e.jsx("button",{type:"button",onClick:()=>k(!1),style:{position:"absolute",right:"20px",top:"20px",background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:e.jsx(Ee,{size:20})})]}),de&&e.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:"Loading accountsâ€¦"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx("div",{className:"neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{type:"date",id:"tx_date",value:G,onChange:s=>ue(s.target.value),placeholder:" ",required:!0}),e.jsx("label",{htmlFor:"tx_date",children:"Date"}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})})]})}),e.jsxs("div",{className:"neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Account *"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:v,onChange:s=>H(s.target.value?Number(s.target.value):""),required:!0,children:[e.jsx("option",{value:"",children:"Select account"}),I.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type *"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:C,onChange:s=>me(s.target.value),children:[e.jsx("option",{value:"EXPENSE",children:"Expense"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"TRANSFER",children:"Transfer"})]})]}),e.jsx("div",{className:"neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{type:"number",step:"0.01",id:"tx_amount",value:E,onChange:s=>X(s.target.value),placeholder:" ",required:!0}),e.jsx("label",{htmlFor:"tx_amount",children:"Amount"}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})})]})}),e.jsxs("div",{className:"sm:col-span-2 neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:D,onChange:s=>xe(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"â€” None â€”"}),Ne.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.kind,")"]},s.id))]})]}),e.jsxs("div",{className:"sm:col-span-2 neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"ðŸ’° Savings Goal (Optional)"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:T,onChange:s=>V(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"â€” No savings goal â€”"}),ie.map(s=>e.jsxs("option",{value:s.id,children:[s.emoji," ",s.name," (",s.progress_percentage.toFixed(0),"% complete)"]},s.id))]}),e.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Link this expense to a savings goal to track contributions"})]}),e.jsx("div",{className:"sm:col-span-2 neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{id:"tx_description",value:z,onChange:s=>U(s.target.value),placeholder:" "}),e.jsx("label",{htmlFor:"tx_description",children:"e.g. Lunch at Java, rent, salary..."}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})]})}),e.jsxs("div",{className:"sm:col-span-2 neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tags (optional)"}),b.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:b.map(s=>e.jsx("button",{type:"button",onClick:()=>{const t=f?f.split(",").map(n=>n.trim()).filter(Boolean):[];t.includes(s.name)?y(t.filter(n=>n!==s.name).join(", ")):y([...t,s.name].join(", "))},className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.split(",").map(t=>t.trim()).includes(s.name)?"ring-2 ring-offset-2 opacity-100":"opacity-60 hover:opacity-100"}`,style:{backgroundColor:s.color+"20",color:s.color,borderColor:s.color},children:s.name},s.id))}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:f,onChange:s=>y(s.target.value),placeholder:"comma,separated,tags"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:K||I.length===0,className:"neu-button flex-1 disabled:opacity-60",children:K?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"neu-spinner"}),e.jsx("span",{children:"Savingâ€¦"})]}):"Save Transaction"}),e.jsx("button",{type:"button",onClick:()=>k(!1),className:"btn-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Recent Transactions"}),x!==null&&e.jsxs("div",{className:"text-sm text-[var(--text-muted)]",children:[c+1,"-",Math.min(c+m,x)," of ",x]})]}),P&&e.jsx("div",{className:"skeleton h-32 rounded"}),!P&&w.length===0&&e.jsxs("div",{className:"text-center py-12 text-[var(--text-muted)]",children:[e.jsx("p",{className:"text-lg mb-2",children:"No transactions yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add" to create your first transaction'})]}),e.jsx("div",{className:"block md:hidden space-y-3",children:w.map(s=>{const t=s.tags?s.tags.split(",").map(r=>r.trim()).filter(Boolean):[],n=Object.fromEntries(b.map(r=>[r.name,r.color]));return e.jsxs("div",{className:"p-4 bg-[var(--surface)] rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.description||"â€”"}),e.jsxs("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:[s.date," â€¢ ",s.account_name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-lg",children:F(s.amount)}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-medium ${s.kind==="INCOME"?"bg-green-100 text-green-800":s.kind==="EXPENSE"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.kind})]})]}),s.category_name&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-[var(--text-muted)]",children:"Category:"})," ",e.jsx("span",{className:"font-medium",children:s.category_name})]}),s.savings_goal_name&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-[var(--text-muted)]",children:"Savings Goal:"})," ",e.jsxs("span",{className:"font-medium",children:[s.savings_goal_emoji," ",s.savings_goal_name]})]}),t.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((r,d)=>e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:(n[r]||"#3B82F6")+"20",color:n[r]||"#3B82F6"},children:r},d))})]},s.id)})}),w.length>0&&e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[var(--surface)] sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Account"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Savings Goal"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Tags"})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border-subtle)]",children:w.map(s=>{const t=s.tags?s.tags.split(",").map(r=>r.trim()).filter(Boolean):[],n=Object.fromEntries(b.map(r=>[r.name,r.color]));return e.jsxs("tr",{className:"hover:bg-[var(--surface)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:s.date}),e.jsx("td",{className:"px-4 py-3",children:s.account_name}),e.jsx("td",{className:"px-4 py-3",children:s.category_name??e.jsx("span",{className:"text-[var(--text-muted)]",children:"â€“"})}),e.jsx("td",{className:"px-4 py-3",children:s.savings_goal_name?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500/10 to-purple-500/10 text-blue-600 dark:text-blue-400",children:[e.jsx("span",{children:s.savings_goal_emoji}),e.jsx("span",{children:s.savings_goal_name})]}):e.jsx("span",{className:"text-[var(--text-muted)]",children:"â€“"})}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:F(s.amount)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.kind==="INCOME"?"bg-green-100 text-green-800":s.kind==="EXPENSE"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.kind})}),e.jsx("td",{className:"px-4 py-3",children:s.description}),e.jsx("td",{className:"px-4 py-3",children:t.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((r,d)=>e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:(n[r]||"#3B82F6")+"20",color:n[r]||"#3B82F6"},children:r},d))}):e.jsx("span",{className:"text-[var(--text-muted)]",children:"â€“"})})]},s.id)})})]})}),x!==null&&x>m&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsx("button",{className:"btn-secondary text-sm",onClick:()=>L(Math.max(0,c-m)),disabled:c===0,children:"Previous"}),e.jsxs("div",{className:"text-sm text-[var(--text-muted)]",children:["Page ",Math.floor(c/m)+1," of ",Math.ceil(x/m)]}),e.jsx("button",{className:"btn-secondary text-sm",onClick:()=>L(c+m),disabled:c+m>=x,children:"Next"})]})]})]})}export{Ke as default};
