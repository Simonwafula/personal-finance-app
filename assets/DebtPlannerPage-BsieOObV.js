import{i as w,r as a,j as e}from"./index-HX_wmsfL.js";import{R as ae,A as re,X as le,T as ne,a as P}from"./AreaChart-Ci19JBcu.js";async function be(){return(await w.get("/api/debt/debt-plans/")).data}async function ie(r){return(await w.post("/api/debt/debt-plans/",r)).data}async function D(r,u){const k=u?`/api/debt/debt-plans/${r}/schedule/?strategy=${encodeURIComponent(u)}`:`/api/debt/debt-plans/${r}/schedule/`,v=await w.get(k);return v.data?.schedule||v.data}async function pe(r,u){return(await w.patch(`/api/debt/debt-plans/${r}/`,u)).data}async function ge(r){await w.delete(`/api/debt/debt-plans/${r}/`)}function x(r){const u=typeof r=="string"?Number(r):r;return Number.isNaN(u)?r.toString():u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function ve(){const[r,u]=a.useState([]),[k,v]=a.useState(!1),[d,S]=a.useState(null),[n,j]=a.useState([]),[E,L]=a.useState(!1),[F,I]=a.useState("AVALANCHE"),[M,O]=a.useState("0"),[B,R]=a.useState(new Date().toISOString().slice(0,10)),[$,f]=a.useState(null),[V,H]=a.useState(!1),[T,W]=a.useState("AVALANCHE"),[G,K]=a.useState("0"),[U,z]=a.useState(new Date().toISOString().slice(0,10)),[h,de]=a.useState(null),[C,oe]=a.useState(!1),[ce,A]=a.useState(!1),[X,_]=a.useState(null),[q,J]=a.useState(null),l=a.useMemo(()=>r.find(t=>t.id===d)||null,[r,d]),{monthsCount:me,totalInterest:Q,initialDebt:xe,timeline:Y}=a.useMemo(()=>{if(!n||n.length===0)return{monthsCount:0,totalInterest:0,totalPrincipal:0,totalPayments:0,initialDebt:0,timeline:[]};const t=new Set,s=new Map;let i=0,y=0,b=0;const o={};for(const c of n){const m=String(c.month).slice(0,7);t.add(m);const Z=c.liability_id;s.has(Z)||s.set(Z,Number(c.starting_balance));const ee=Number(c.interest),te=Number(c.principal),se=Number(c.payment),he=Number(c.ending_balance);i+=ee,y+=te,b+=se,o[m]||(o[m]={payment:0,interest:0,principal:0,ending:0}),o[m].payment+=se,o[m].interest+=ee,o[m].principal+=te,o[m].ending+=he}const p=Array.from(s.values()).reduce((c,m)=>c+m,0),g=t.size,ue=Object.entries(o).sort((c,m)=>c[0].localeCompare(m[0])).map(([c,m])=>({month:c,remaining:Math.max(m.ending,0)}));return{monthsCount:g,totalInterest:i,totalPrincipal:y,totalPayments:b,initialDebt:p,timeline:ue}},[n]);async function N(){try{v(!0);const t=await be();u(t),t.length>0&&d==null&&S(t[0].id)}catch(t){console.error(t),f("Failed to load debt plans")}finally{v(!1)}}return a.useEffect(()=>{N()},[]),a.useEffect(()=>{if(!d){j([]);return}async function t(){try{const s=await D(d);j(s||[])}catch(s){console.error(s),j([])}}t()},[d]),a.useEffect(()=>{l&&(W(l.strategy),K(String(l.monthly_amount_available)),z(l.start_date))},[l?.id]),a.useEffect(()=>{async function t(){if(!l||!d){_(null),J(null);return}const s=l.strategy==="AVALANCHE"?"SNOWBALL":"AVALANCHE";J(s);try{const y=(await D(d,s)).reduce((b,o)=>b+Number(o.interest),0);_(y)}catch(i){console.error(i),_(null)}}t()},[l?.strategy,d,n.length]),e.jsxs("div",{className:"space-y-6 pb-20 max-w-7xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"ðŸ’³ Debt Planner"}),e.jsx("p",{className:"text-base text-[var(--text-muted)] mt-2 font-medium",children:"Build payoff strategies using Avalanche or Snowball methods"})]}),r.length>0&&e.jsxs("div",{className:"inline-flex px-4 py-2 rounded-full bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 text-sm font-semibold",children:[r.length," ",r.length===1?"Plan":"Plans"]})]}),k&&e.jsx("div",{className:"skeleton h-32 rounded"}),$&&e.jsx("div",{className:"card bg-red-50 border-red-200 text-red-700 text-sm p-4 animate-slide-in",children:$}),e.jsxs("div",{className:"card animate-slide-in",children:[e.jsxs("div",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“"}),"Create Debt Plan"]}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault(),L(!0);try{await ie({strategy:F,monthly_amount_available:Number(M),start_date:B}),I("AVALANCHE"),O("0"),R(new Date().toISOString().slice(0,10)),await N()}catch(s){console.error(s),f("Failed to create plan")}finally{L(!1)}},children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Strategy"}),e.jsxs("select",{value:F,onChange:t=>I(t.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",children:[e.jsx("option",{value:"AVALANCHE",children:"Avalanche"}),e.jsx("option",{value:"SNOWBALL",children:"Snowball"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Monthly Amount *"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:M,onChange:t=>O(t.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Start Date"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:B,onChange:t=>R(t.target.value)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-subtle)]",children:e.jsx("button",{className:"btn-primary",disabled:E,children:E?"Creatingâ€¦":"Create Plan"})})]})]}),n.length>0&&e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Total Debt"}),e.jsx("div",{className:"text-2xl font-bold",children:x(xe)}),e.jsx("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:"At plan start"})]}),e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Monthly Budget"}),e.jsx("div",{className:"text-2xl font-bold",children:x(Number(l?.monthly_amount_available||0))}),e.jsx("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Allocated to debts"})]}),e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Months to Payoff"}),e.jsx("div",{className:"text-2xl font-bold",children:me}),e.jsx("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Based on current plan"})]}),e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Total Interest"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:x(Q)}),e.jsx("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Cumulative interest"})]}),X!=null&&e.jsxs("div",{className:"card hover:shadow-lg transition-shadow lg:col-span-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:["Interest Saved vs ",q]}),(()=>{const t=Math.round((X-Q)*100)/100,s=t>0;return e.jsxs("div",{className:`text-2xl font-bold ${s?"text-green-600 dark:text-green-400":"text-[var(--text)]"}`,children:[s?"+":"",x(t),e.jsxs("span",{className:"ml-2 text-sm text-[var(--text-muted)]",children:[s?"less interest than":"vs"," ",q]})]})})()]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"}),"Plans"]}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-[var(--surface)] hover:bg-[var(--surface-hover)]",onClick:()=>H(t=>!t),children:V?"Cancel":"Edit"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-[var(--surface)] hover:bg-[var(--surface-hover)]",onClick:async()=>{if(l)try{const t=await ie({strategy:l.strategy,monthly_amount_available:Number(l.monthly_amount_available),start_date:l.start_date});await N(),S(t.id)}catch(t){console.error(t),f("Failed to duplicate plan")}},children:"Duplicate"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-red-50 text-red-700 hover:bg-red-100",onClick:()=>A(!0),children:"Delete"})]})]}),r.map(t=>e.jsx("div",{className:"mb-2",children:e.jsxs("button",{onClick:()=>S(t.id),className:`w-full text-left px-4 py-3 rounded-lg text-sm transition-all ${d===t.id?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"bg-[var(--surface)] hover:bg-[var(--surface-hover)] hover:shadow-md"}`,children:[e.jsx("div",{className:"font-semibold",children:t.strategy}),e.jsxs("div",{className:`${d===t.id?"text-white/80":"text-[var(--text-muted)]"} text-xs mt-1`,children:[t.start_date," â€¢ ",x(Number(t.monthly_amount_available))]})]})},t.id)),V&&l&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-[var(--border-subtle)]",children:[e.jsx("div",{className:"text-sm font-semibold mb-3",children:"Edit Plan"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Strategy"}),e.jsxs("select",{value:T,onChange:t=>W(t.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",children:[e.jsx("option",{value:"AVALANCHE",children:"Avalanche"}),e.jsx("option",{value:"SNOWBALL",children:"Snowball"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Monthly Amount"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:G,onChange:t=>K(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Start Date"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:U,onChange:t=>z(t.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn-primary",onClick:async()=>{if(l)try{await pe(l.id,{strategy:T,monthly_amount_available:Number(G),start_date:U}),await N(),H(!1)}catch(t){console.error(t),f("Failed to update plan")}},children:"Save Changes"})})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“ˆ"}),"Schedule"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-[var(--surface)] hover:bg-[var(--surface-hover)]",onClick:()=>{if(!n||n.length===0)return;const t=["month","liability_id","liability_name","starting_balance","interest","payment","principal","ending_balance"],s=n.filter(p=>!h||p.liability_id===h).map(p=>t.map(g=>String(p[g]))),i=[t.join(","),...s.map(p=>p.map(g=>/[",\n]/.test(g)?'"'+g.replace(/"/g,'""')+'"':g).join(","))].join(`
`),y=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(y),o=document.createElement("a");o.href=b,o.download=`debt_schedule_${l?.id??"plan"}.csv`,o.click(),URL.revokeObjectURL(b)},children:"Export CSV"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-[var(--surface)] hover:bg-[var(--surface-hover)]",onClick:async()=>{if(d)try{const t=await D(d);j(t||[])}catch(t){console.error(t),f("Failed to recalculate schedule")}},children:"Recalculate"})]})]}),n.length>0&&e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Liability Filter"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:h??"",onChange:t=>de(t.target.value?Number(t.target.value):null),children:[e.jsx("option",{value:"",children:"All"}),Array.from(new Map(n.map(t=>[t.liability_id,t.liability_name])).entries()).map(([t,s])=>e.jsx("option",{value:t,children:s},t))]}),e.jsxs("label",{className:"inline-flex items-center gap-2 mt-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>oe(t.target.checked)}),"Show only selected"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Payoff Order"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Map(n.map((t,s)=>[t.liability_id,{name:t.liability_name,idx:s}])).entries()).sort((t,s)=>t[1].idx-s[1].idx).map(([t,s],i)=>e.jsxs("span",{className:`px-2.5 py-1 rounded-full text-xs ${h===t?"bg-blue-600 text-white":"bg-[var(--surface)]"}`,children:[i+1,". ",s.name]},t))})]})]}),Y.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Payoff Timeline"}),e.jsx("div",{style:{width:"100%",height:220},children:e.jsx(ae,{width:"100%",height:220,children:e.jsxs(re,{data:Y,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"debtGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8B5CF6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#8B5CF6",stopOpacity:0})]})}),e.jsx(le,{dataKey:"month",stroke:"var(--text-muted)"}),e.jsx(ne,{formatter:t=>x(t),contentStyle:{background:"var(--surface)",border:"1px solid var(--glass-border)",borderRadius:"12px",backdropFilter:"blur(20px)"}}),e.jsx(P,{type:"monotone",dataKey:"remaining",stroke:"#8B5CF6",strokeWidth:2,fill:"url(#debtGradient)"})]})})})]}),n.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Payments Breakdown"}),e.jsx("div",{style:{width:"100%",height:220},children:e.jsx(ae,{width:"100%",height:220,children:e.jsxs(re,{data:Object.entries(n.reduce((t,s)=>{if(h&&s.liability_id!==h&&C)return t;const i=String(s.month).slice(0,7);return t[i]||(t[i]={month:i,interest:0,principal:0}),t[i].interest+=Number(s.interest),t[i].principal+=Number(s.principal),t},{})).sort((t,s)=>t[0].localeCompare(s[0])).map(([,t])=>t),children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"debtInterest",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#EF4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#EF4444",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"debtPrincipal",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})]}),e.jsx(le,{dataKey:"month",stroke:"var(--text-muted)"}),e.jsx(ne,{formatter:t=>x(t),contentStyle:{background:"var(--surface)",border:"1px solid var(--glass-border)",borderRadius:"12px",backdropFilter:"blur(20px)"}}),e.jsx(P,{type:"monotone",dataKey:"interest",name:"Interest",stackId:"1",stroke:"#EF4444",strokeWidth:2,fill:"url(#debtInterest)"}),e.jsx(P,{type:"monotone",dataKey:"principal",name:"Principal",stackId:"1",stroke:"#10B981",strokeWidth:2,fill:"url(#debtPrincipal)"})]})})})]}),n.length===0&&e.jsx("div",{className:"text-center py-16 text-[var(--text-muted)]",children:"Select a plan to view the schedule"}),n.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[var(--surface)] sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Month"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Liability"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Starting"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Interest"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Principal"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Ending"})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border-subtle)]",children:n.filter(t=>!C||!h||t.liability_id===h).map((t,s)=>e.jsxs("tr",{className:`hover:bg-[var(--surface)] transition-colors ${h&&t.liability_id!==h&&!C?"opacity-40":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:t.month}),e.jsx("td",{className:"px-4 py-3",children:t.liability_name}),e.jsx("td",{className:"px-4 py-3 text-right",children:x(t.starting_balance)}),e.jsx("td",{className:"px-4 py-3 text-right",children:x(t.interest)}),e.jsx("td",{className:"px-4 py-3 text-right",children:x(t.payment)}),e.jsx("td",{className:"px-4 py-3 text-right",children:x(t.principal)}),e.jsx("td",{className:"px-4 py-3 text-right",children:x(t.ending_balance)})]},s))})]})})]})})]}),ce&&l&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{className:"card max-w-md w-full",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Delete Plan?"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)] mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-[var(--surface)] hover:bg-[var(--surface-hover)]",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md text-sm bg-red-600 text-white hover:bg-red-700",onClick:async()=>{try{await ge(l.id),A(!1),await N(),S(null),j([])}catch(t){console.error(t),f("Failed to delete plan")}},children:"Delete"})]})]})})]})]})}export{ve as default};
