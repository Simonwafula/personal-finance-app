import{r as a,j as e,L as g}from"./index-HX_wmsfL.js";import{materializeRecurring as ce,createRecurring as de,previewRecurring as xe,updateRecurring as ue,deleteRecurring as me,fetchAccounts as ge,fetchCategories as he,fetchRecurring as pe}from"./finance-CqPMwo_Z.js";import{R as be,A as fe,X as ye,T as je,a as N}from"./AreaChart-Ci19JBcu.js";function Ne(d){const h=typeof d=="string"?Number(d):d;return Number.isNaN(h)?d.toString():h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function Ee(){const[d,h]=a.useState([]),[v,U]=a.useState([]),[o,V]=a.useState([]),[b,k]=a.useState(!0),[w,p]=a.useState(null),[E,J]=a.useState({}),[f,S]=a.useState(""),[D,C]=a.useState(new Date().toISOString().slice(0,10)),[F,M]=a.useState("0"),[A,R]=a.useState("EXPENSE"),[y,I]=a.useState(""),[L,Y]=a.useState(""),[O,T]=a.useState("MONTHLY"),[q,P]=a.useState(""),[K,W]=a.useState(!1),[X,Q]=a.useState(!0),[_,Z]=a.useState(!1),[B,ee]=a.useState(!1);async function x(){try{k(!0);const[t,r,i]=await Promise.all([ge(),he(),pe()]);h(t),U(r),V(i)}catch(t){console.error(t),p("Failed to load subscriptions")}finally{k(!1)}}a.useEffect(()=>{x()},[]);const te=a.useMemo(()=>v.filter(t=>t.kind==="EXPENSE"),[v]),H=a.useCallback((t,r)=>{function i(m,ne){const $=m.getMonth()+ne,le=m.getFullYear()+Math.floor($/12),oe=($%12+12)%12,ie=Math.min(m.getDate(),28);return new Date(le,oe,ie)}function c(m){return m.toISOString().slice(0,10)}const u=[],j=new Date,l=new Date(j.getTime()+r*24*60*60*1e3);let s=new Date(t.date);t.last_executed&&(s=new Date(t.last_executed),t.frequency==="DAILY"?s.setDate(s.getDate()+1):t.frequency==="WEEKLY"?s.setDate(s.getDate()+7):t.frequency==="MONTHLY"?s=i(s,1):s=new Date(s.getFullYear()+1,s.getMonth(),s.getDate()));const n=t.end_date?new Date(t.end_date):null,re=(t.kind==="INCOME"?1:t.kind==="EXPENSE"?-1:0)*Number(t.amount);for(;s<=l&&(!n||s<=n);)u.push({date:c(s),amount:re}),t.frequency==="DAILY"?s.setDate(s.getDate()+1):t.frequency==="WEEKLY"?s.setDate(s.getDate()+7):t.frequency==="MONTHLY"?s=i(s,1):s=new Date(s.getFullYear()+1,s.getMonth(),s.getDate());return u},[]),{monthlyIncome:se,monthlyExpenses:ae,next30Net:z,forecastSeries:G}=a.useMemo(()=>{let t=0,r=0;const i={DAILY:30,WEEKLY:4.345,MONTHLY:1,YEARLY:1/12};for(const l of o){const s=Number(l.amount),n=i[l.frequency];l.kind==="INCOME"?t+=s*n:l.kind==="EXPENSE"&&(r+=s*n)}const c={};for(const l of o){const s=H(l,60);for(const n of s)c[n.date]||(c[n.date]={income:0,expenses:0,net:0}),n.amount>=0?c[n.date].income+=n.amount:c[n.date].expenses+=Math.abs(n.amount),c[n.date].net+=n.amount}const u=Object.entries(c).sort((l,s)=>l[0].localeCompare(s[0])).map(([l,s])=>({date:l,net:s.net,income:s.income,expenses:s.expenses})),j=u.slice(0,30).reduce((l,s)=>l+s.net,0);return{monthlyIncome:t,monthlyExpenses:r,next30Net:j,forecastSeries:u}},[o,H]);return e.jsxs("div",{className:"space-y-6 pb-20 max-w-7xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"ðŸ”„ Recurring Transactions"}),e.jsx("p",{className:"text-base text-[var(--text-muted)] mt-2 font-medium",children:"Manage subscriptions, bills, and recurring income"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[o.length>0&&e.jsxs("div",{className:"inline-flex px-4 py-2 rounded-full bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 text-sm font-semibold",children:[o.length," ",o.length===1?"Item":"Items"]}),e.jsx("button",{className:"btn-secondary",onClick:()=>x(),children:"ðŸ”„ Refresh"}),e.jsx("button",{className:"btn-primary",onClick:async()=>{try{const t=await ce(30);alert(`âœ… Created ${t.created} upcoming transactions`),await x()}catch(t){console.error(t),p("Failed to materialize recurring")}},children:"âš¡ Materialize 30 Days"})]})]}),!b&&e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Monthly Income"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:se.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Monthly Expenses"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:ae.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2",children:"Next 30 Days (Net)"}),e.jsx("div",{className:`text-2xl font-bold ${z>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:z.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]}),!b&&G.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“ˆ"}),"Upcoming Cashflow (60 days)"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:X,onChange:t=>Q(t.target.checked)}),"Net"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:t=>Z(t.target.checked)}),"Income"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:t=>ee(t.target.checked)}),"Expenses"]})]})]}),e.jsx("div",{style:{width:"100%",height:220},children:e.jsx(be,{width:"100%",height:220,children:e.jsxs(fe,{data:G,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"subsNet",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"subsIncome",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"subsExpenses",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#EF4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#EF4444",stopOpacity:0})]})]}),e.jsx(ye,{dataKey:"date",stroke:"var(--text-muted)"}),e.jsx(je,{formatter:t=>Number(t).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),contentStyle:{background:"var(--surface)",border:"1px solid var(--glass-border)",borderRadius:"12px",backdropFilter:"blur(20px)"}}),X&&e.jsx(N,{type:"monotone",dataKey:"net",name:"Net",stroke:"#3B82F6",strokeWidth:2,fill:"url(#subsNet)"}),_&&e.jsx(N,{type:"monotone",dataKey:"income",name:"Income",stroke:"#10B981",strokeWidth:2,fill:"url(#subsIncome)"}),B&&e.jsx(N,{type:"monotone",dataKey:"expenses",name:"Expenses",stroke:"#EF4444",strokeWidth:2,fill:"url(#subsExpenses)"})]})})})]}),b&&e.jsx("div",{className:"skeleton h-40 rounded"}),w&&e.jsx("div",{className:"card bg-red-50 border-red-200 text-red-700 text-sm p-4 animate-slide-in",children:w}),e.jsxs("div",{className:"grid lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card sticky top-6 bg-gradient-to-br from-blue-50/50 to-purple-50/50 dark:from-blue-900/10 dark:to-purple-900/10 border-2",children:[e.jsxs("div",{className:"text-lg font-semibold mb-6 flex items-center gap-2",children:[e.jsx("span",{children:"âž•"}),"Add Recurring Transaction"]}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault(),W(!0),p(null);try{if(!f)throw new Error("Select account");await de({account:Number(f),date:D,amount:Number(F),kind:A,category:y?Number(y):void 0,description:L,frequency:O,end_date:q||void 0}),S(""),C(new Date().toISOString().slice(0,10)),M("0"),R("EXPENSE"),I(""),Y(""),T("MONTHLY"),P(""),await x()}catch(r){console.error(r);const i=r instanceof Error?r.message:"Failed to create recurring";p(i)}finally{W(!1)}},children:[e.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Account *"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:f,onChange:t=>S(t.target.value?Number(t.target.value):""),required:!0,children:[e.jsx("option",{value:"",children:"Select account"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Date *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:D,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:F,onChange:t=>M(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kind"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:A,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"EXPENSE",children:"Expense"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"TRANSFER",children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:y,onChange:t=>I(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:"Uncategorized"}),te.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:O,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"DAILY",children:"Daily"}),e.jsx("option",{value:"WEEKLY",children:"Weekly"}),e.jsx("option",{value:"MONTHLY",children:"Monthly"}),e.jsx("option",{value:"YEARLY",children:"Yearly"})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:L,onChange:t=>Y(t.target.value),placeholder:"e.g., Netflix, Rent, Gym"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"End Date"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:q,onChange:t=>P(t.target.value)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-subtle)]",children:e.jsx("button",{className:"btn-primary",disabled:K,children:K?"Addingâ€¦":"Add Recurring"})})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-pink-50/50 to-rose-50/50 dark:from-pink-900/10 dark:to-rose-900/10 border border-pink-200 dark:border-pink-800",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ”„"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Recurring Expense Tips"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Manage subscriptions effectively"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs(g,{to:"/blog/audit-subscriptions",className:"flex gap-2 group hover:bg-white/50 dark:hover:bg-gray-800/50 p-3 rounded-lg transition-all",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"â€¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Audit Regularly:"})," Review all subscriptions quarterly and cancel unused services."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]}),e.jsxs(g,{to:"/blog/annual-vs-monthly-billing",className:"flex gap-2 group hover:bg-white/50 dark:hover:bg-gray-800/50 p-3 rounded-lg transition-all",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-bold",children:"â€¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Annual vs Monthly:"})," Annual payments often save 10-20% compared to monthly billing."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]}),e.jsxs(g,{to:"/blog/subscription-renewal-reminders",className:"flex gap-2 group hover:bg-white/50 dark:hover:bg-gray-800/50 p-3 rounded-lg transition-all",children:[e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:"â€¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Set Reminders:"})," Mark renewal dates to evaluate value before auto-renewal kicks in."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]}),e.jsxs(g,{to:"/blog/shared-subscription-plans",className:"flex gap-2 group hover:bg-white/50 dark:hover:bg-gray-800/50 p-3 rounded-lg transition-all",children:[e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-bold",children:"â€¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Share Plans:"})," Family plans for Netflix, Spotify, or YouTube Premium split costs effectively."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-[var(--border-subtle)]",children:e.jsx(g,{to:"/blog",className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium",children:"View All Financial Tips â†’"})})]})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"}),"Your Recurring Items ",o.length>0&&`(${o.length})`]}),o.length===0&&e.jsx("div",{className:"text-center py-12 text-[var(--text-muted)]",children:"No recurring items yet"}),o.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[var(--surface)] sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Account"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Frequency"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Next Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Preview"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border-subtle)]",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-[var(--surface)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:t.description||"(No description)"}),e.jsx("td",{className:"px-4 py-3",children:t.account_name}),e.jsx("td",{className:"px-4 py-3",children:t.category_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:Ne(t.amount)}),e.jsx("td",{className:"px-4 py-3",children:t.frequency}),e.jsx("td",{className:"px-4 py-3",children:t.date}),e.jsx("td",{className:"px-4 py-3",children:E[t.id]?.length?e.jsx("div",{className:"text-xs text-[var(--text-muted)]",children:E[t.id].join(", ")}):e.jsx("button",{className:"px-2 py-1 rounded bg-[var(--surface)] hover:bg-[var(--surface-hover)] text-xs",onClick:async()=>{try{const r=await xe(t.id);J(i=>({...i,[t.id]:r.dates}))}catch(r){console.error(r)}},children:"Show dates"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-[var(--surface)] hover:bg-[var(--surface-hover)] text-xs",onClick:async()=>{try{await ue(t.id,{end_date:new Date().toISOString().slice(0,10)}),await x()}catch(r){console.error(r)}},title:"End today",children:"End"}),e.jsx("button",{className:"px-2 py-1 rounded bg-red-50 text-red-700 hover:bg-red-100 text-xs",onClick:async()=>{if(confirm("Delete recurring item?"))try{await me(t.id),await x()}catch(r){console.error(r)}},children:"Delete"})]})})]},t.id))})]})})]})})]})]})}export{Ee as default};
