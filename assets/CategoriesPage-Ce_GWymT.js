import{r as s,a as ae,j as e,w as re,x as le,c as I,k as O,l as $,L as ne,h as W}from"./index-HX_wmsfL.js";import{fetchCategories as ie,fetchTags as oe,fetchTagAnalysis as de,updateCategory as ce,createCategory as ge,deleteCategory as xe,updateTag as me,createTag as ue,deleteTag as he}from"./finance-CqPMwo_Z.js";function pe(l){const m=typeof l=="string"?Number(l):l;return Number.isNaN(m)?l.toString():m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function ye(){const[l,m]=s.useState([]),[w,B]=s.useState([]),[D,U]=s.useState([]),[k,z]=s.useState(!1),[M,r]=s.useState(null),{range:n}=ae(),[q,i]=s.useState(!1),[u,h]=s.useState(""),[E,p]=s.useState("EXPENSE"),[b,T]=s.useState(null),[P,K]=s.useState(!1),[G,o]=s.useState(!1),[f,y]=s.useState(""),[j,x]=s.useState("#3B82F6"),[N,S]=s.useState(null),[L,R]=s.useState(!1),[d,Y]=s.useState(!1),[v,X]=s.useState("categories"),[c,C]=s.useState("ALL");async function A(){try{z(!0),r(null);const t=await ie();m(t)}catch(t){console.error(t),r("Failed to load categories")}finally{z(!1)}}async function F(){try{const t=await oe();B(t)}catch(t){console.error(t)}}async function H(){try{const t=await de({start:n.startDate,end:n.endDate});U(t.tags)}catch(t){console.error(t)}}s.useEffect(()=>{A(),F()},[]),s.useEffect(()=>{d&&H()},[d,n.startDate,n.endDate]);async function J(t){if(t.preventDefault(),!!u.trim())try{K(!0),r(null),b?await ce(b.id,{name:u,kind:E}):await ge({name:u,kind:E}),await A(),h(""),p("EXPENSE"),T(null),i(!1)}catch(a){console.error(a),r("Failed to save category")}finally{K(!1)}}async function Q(t){if(confirm("Delete this category? Transactions using it will have no category."))try{r(null),await xe(t),await A()}catch(a){console.error(a),r("Failed to delete category")}}function V(t){T(t),h(t.name),p(t.kind),i(!0)}function Z(){T(null),h(""),p("EXPENSE"),i(!0)}async function _(t){if(t.preventDefault(),!!f.trim())try{R(!0),r(null),N?await me(N.id,{name:f,color:j}):await ue({name:f,color:j}),await F(),y(""),x("#3B82F6"),S(null),o(!1)}catch(a){console.error(a),r("Failed to save tag")}finally{R(!1)}}async function ee(t){if(confirm("Delete this tag?"))try{r(null),await he(t),await F(),d&&await H()}catch(a){console.error(a),r("Failed to delete tag")}}function te(t){S(t),y(t.name),x(t.color),o(!0)}function se(){S(null),y(""),x("#3B82F6"),o(!0)}return e.jsxs("div",{className:"space-y-6 pb-20 max-w-7xl mx-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Categories & Tags"}),e.jsx("p",{className:"text-base text-[var(--text-muted)] mt-1 font-medium",children:"Organize your transactions with custom categories and tags"})]}),M&&e.jsx("div",{className:"card bg-red-50 border-red-200 text-red-700 text-sm p-4",children:M}),e.jsxs("div",{className:"card p-1 flex gap-1 bg-[var(--surface)]",children:[e.jsxs("button",{onClick:()=>X("categories"),className:`flex-1 px-6 py-3 font-semibold rounded-lg transition-all ${v==="categories"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:[e.jsx(re,{className:"inline mr-2",size:20}),"Categories"]}),e.jsxs("button",{onClick:()=>X("tags"),className:`flex-1 px-6 py-3 font-semibold rounded-lg transition-all ${v==="tags"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:[e.jsx(le,{className:"inline mr-2",size:20}),"Tags"]})]}),v==="categories"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Manage Categories"}),e.jsxs("button",{onClick:Z,className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(I,{size:18}),"Add Category"]})]}),e.jsxs("div",{className:"card p-1 flex gap-1 bg-[var(--surface)]",children:[e.jsx("button",{onClick:()=>C("ALL"),className:`flex-1 px-4 py-2.5 font-medium rounded-lg transition-all text-sm ${c==="ALL"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:"All Types"}),e.jsx("button",{onClick:()=>C("EXPENSE"),className:`flex-1 px-4 py-2.5 font-medium rounded-lg transition-all text-sm ${c==="EXPENSE"?"bg-gradient-to-r from-red-600 to-orange-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:"Expenses"}),e.jsx("button",{onClick:()=>C("INCOME"),className:`flex-1 px-4 py-2.5 font-medium rounded-lg transition-all text-sm ${c==="INCOME"?"bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:"Income"}),e.jsx("button",{onClick:()=>C("TRANSFER"),className:`flex-1 px-4 py-2.5 font-medium rounded-lg transition-all text-sm ${c==="TRANSFER"?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg":"text-[var(--text-muted)] hover:bg-[var(--glass-bg)]"}`,children:"Transfers"})]}),k&&e.jsx("div",{className:"skeleton h-32 rounded"}),!k&&l.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx("p",{className:"text-lg text-[var(--text-muted)] mb-2",children:"No categories yet"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:'Click "Add Category" to create your first one'})]}),!k&&l.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:(c==="ALL"?["EXPENSE","INCOME","TRANSFER"]:[c]).map(t=>{const a=l.filter(g=>g.kind===t);return a.length===0?null:e.jsxs("div",{className:"card space-y-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide pb-2 border-b",children:[t==="EXPENSE"?"Expenses":t==="INCOME"?"Income":"Transfer",e.jsxs("span",{className:"ml-2 text-blue-600",children:["(",a.length,")"]})]}),a.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[var(--surface)] rounded-lg hover:shadow-md transition-shadow group",children:[e.jsx("span",{className:"text-sm font-medium",children:g.name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>V(g),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit",children:e.jsx(O,{size:14})}),e.jsx("button",{onClick:()=>Q(g.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete",children:e.jsx($,{size:14})})]})]},g.id))]},t)})}),e.jsxs("div",{className:"card bg-gradient-to-br from-indigo-50/50 to-purple-50/50 dark:from-indigo-900/10 dark:to-purple-900/10 border border-indigo-200 dark:border-indigo-800",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ·ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Why Categorization Matters"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Transform financial chaos into clarity"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm mb-4",children:[e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("strong",{children:"Without categories:"}),' "Where did my money go?" Mystery spending, budget failures, hidden leaks.']}),e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("strong",{children:"With categories:"})," Crystal-clear spending patterns, smart budgets based on reality, KES 50K+ annual savings from visibility alone."]}),e.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded-lg p-4 mt-4",children:[e.jsx("p",{className:"font-bold mb-2",children:"Categories reveal:"}),e.jsxs("ul",{className:"space-y-1 text-xs list-disc list-inside",children:[e.jsx("li",{children:"Exactly where every shilling goes (Food: KES 18K, Transport: KES 12K, etc.)"}),e.jsx("li",{children:"Overspending alerts mid-month before you're broke"}),e.jsx("li",{children:"Hidden money leaks (unused gym: KES 3.5K/month, forgotten subscriptions)"}),e.jsx("li",{children:"Tax-deductible expenses for freelancers (save KES 80K+ yearly)"})]})]})]}),e.jsx(ne,{to:"/blog/categorization-importance",className:"inline-block px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all font-medium text-sm",children:"Read Full Guide: Why Categorization Changes Everything â†’"})]})]}),v==="tags"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Manage Tags"}),e.jsxs("button",{onClick:se,className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(I,{size:18}),"Add Tag"]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h5",{className:"text-sm font-semibold",children:"Your Tags"}),e.jsxs("button",{onClick:()=>Y(!d),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:[d?"Hide":"Show"," Analysis"]})]}),w.length===0&&e.jsx("div",{className:"text-center py-8 text-[var(--text-muted)]",children:e.jsx("p",{className:"text-sm",children:'No tags yet. Click "Add Tag" to create one.'})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(t=>e.jsxs("div",{className:"group inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium hover:shadow-md transition-shadow",style:{backgroundColor:t.color+"20",color:t.color},children:[e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>te(t),className:"p-1 hover:opacity-70 transition-opacity",title:"Edit tag",children:e.jsx(O,{size:12})}),e.jsx("button",{onClick:()=>ee(t.id),className:"p-1 hover:opacity-70 transition-opacity",title:"Delete tag",children:e.jsx($,{size:12})})]})]},t.id))}),d&&w.length>0&&e.jsxs("div",{className:"border-t mt-6 pt-6",children:[e.jsxs("div",{className:"text-xs font-medium text-[var(--text-muted)] mb-3 uppercase tracking-wide",children:["Tag Usage Analysis (",n.startDate," to ",n.endDate,")"]}),D.length===0&&e.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:"No transactions with tags in this period."}),e.jsx("div",{className:"space-y-2",children:D.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[var(--surface)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-[var(--text-muted)]",children:["(",t.count," transaction",t.count!==1?"s":"",")"]})]}),e.jsx("span",{className:"text-sm font-semibold",children:pe(t.total)})]},a))})]})]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>i(!1),children:e.jsxs("div",{className:"card max-w-md w-full",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:b?"Edit Category":"Add Category"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{size:20})})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category Name *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:u,onChange:t=>h(t.target.value),placeholder:"e.g. Food & Dining",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type *"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:E,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"EXPENSE",children:"Expense"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"TRANSFER",children:"Transfer"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:P,className:"btn-primary flex-1",children:P?"Savingâ€¦":b?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>o(!1),children:e.jsxs("div",{className:"card max-w-md w-full",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:N?"Edit Tag":"Add Tag"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{size:20})})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tag Name *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:f,onChange:t=>y(t.target.value),placeholder:"e.g. work, personal, vacation",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Color *"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"color",className:"h-14 w-24 border border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer",value:j,onChange:t=>x(t.target.value)}),e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base font-mono bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:j,onChange:t=>x(t.target.value),placeholder:"#3B82F6"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:L,className:"btn-primary flex-1",children:L?"Savingâ€¦":N?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}export{ye as default};
