import{i as g,r,j as e,L as I,T as he}from"./index-HX_wmsfL.js";import{fetchCategories as pe,fetchTransactions as be}from"./finance-CqPMwo_Z.js";/* empty css                    */async function de(){return(await g.get("/api/budgeting/budgets/")).data}async function v(n){return(await g.get(`/api/budgeting/budgets/${n}/summary/`)).data}async function fe(n){return(await g.post("/api/budgeting/budgets/",n)).data}async function ye(n){return(await g.post("/api/budgeting/budget-lines/",n)).data}async function _(n){return(await g.get("/api/budgeting/budget-lines/",{params:{budget:n}})).data}async function je(n,i){return(await g.patch(`/api/budgeting/budget-lines/${n}/`,i)).data}async function Ne(n){await g.delete(`/api/budgeting/budget-lines/${n}/`)}function m(n){const i=typeof n=="string"?Number(n):n;return Number.isNaN(i)?n.toString():i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function Se(){const[n,i]=r.useState([]),[D,R]=r.useState(!1),[$,q]=r.useState(""),[H,ie]=r.useState("MONTHLY"),[O,W]=r.useState("2025-01-01"),[Y,z]=r.useState("2025-01-31"),[U,V]=r.useState(""),[c,N]=r.useState([]),[oe,E]=r.useState(null),[G,J]=r.useState(""),[Q,Z]=r.useState("0"),[w,ce]=r.useState([]),[K,X]=r.useState(""),[ee,te]=r.useState("0"),[l,se]=r.useState(null),[o,h]=r.useState(null),[ae,k]=r.useState(!1),[L,S]=r.useState(!1),[re,p]=r.useState(null),[b,ne]=r.useState(null),[f,le]=r.useState(null),[d,A]=r.useState(null),ue=.9,C=d??o,y=r.useMemo(()=>C?C.lines.map(t=>{const s=Number(t.planned),a=Number(t.actual),u=s>0?a/s:0;return{name:t.category_name,ratio:u}}).filter(t=>t.ratio>=ue).sort((t,s)=>s.ratio-t.ratio):[],[C]);return r.useEffect(()=>{async function t(){try{k(!0);const s=await de();i(s),s.length>0&&se(s[0].id)}catch(s){console.error(s),p("Failed to load budgets")}finally{k(!1)}}t(),(async function(){try{const a=await pe();ce(a)}catch{}})()},[]),r.useEffect(()=>{if(!l){N([]);return}async function t(){try{const[s,a]=await Promise.all([v(l),_(l)]);h(s),N(a)}catch{}}t()},[l]),r.useEffect(()=>{if(!l){h(null);return}async function t(){try{S(!0);const s=await v(l);h(s)}catch(s){console.error(s),p("Failed to load budget summary")}finally{S(!1)}}t()},[l]),r.useEffect(()=>{async function t(){if(!l||!b||!f){A(null);return}try{S(!0);const s=c,a=await be(),u=new Date(b),xe=new Date(f);let F=0,P=0;const me=s.map(j=>{const T=Number(j.planned_amount||0);F+=T;const M=a.filter(x=>x.category===j.category).filter(x=>{const B=new Date(x.date);return B>=u&&B<=xe}).reduce((x,B)=>x+Number(B.amount),0);P+=M;const ge=T-M;return{category_id:j.category,category_name:w.find(x=>x.id===j.category)?.name??"",planned:String(T),actual:String(M),difference:String(ge)}});A({budget:{id:l,name:n.find(j=>j.id===l)?.name??"",start_date:b,end_date:f},lines:me,totals:{planned:String(F),actual:String(P),difference:String(F-P)}})}catch(s){console.error(s)}finally{S(!1)}}t()},[b,f,l,c,w]),e.jsxs("div",{className:"space-y-6 pb-20 max-w-7xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"ðŸ“Š Budgets"}),e.jsx("p",{className:"text-base text-[var(--text-muted)] mt-2 font-medium",children:"Plan and track your spending with custom budgets"})]}),n.length>0&&e.jsxs("div",{className:"inline-flex px-4 py-2 rounded-full bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 text-sm font-semibold",children:[n.length," ",n.length===1?"Budget":"Budgets"]})]}),re&&e.jsx("div",{className:"card bg-red-50 border-red-200 text-red-700 text-sm p-4 animate-slide-in",children:re}),ae&&e.jsx("div",{className:"skeleton h-32 rounded"}),C&&y.length>0&&e.jsx("div",{className:"card border-yellow-300 bg-yellow-50 text-yellow-900 animate-slide-in",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-xl",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Budget usage warning"}),e.jsxs("div",{className:"text-sm",children:[y.length," categor",y.length===1?"y":"ies"," at or above 90% of planned amount."]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[y.slice(0,5).map(t=>e.jsxs("span",{className:"badge bg-yellow-200 text-yellow-900",children:[t.name,": ",Math.round(t.ratio*100),"%"]},t.name)),y.length>5&&e.jsxs("span",{className:"badge bg-yellow-200 text-yellow-900",children:["+",y.length-5," more"]})]})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"neu-card animate-slide-in sticky top-6",children:[e.jsx("div",{className:"neu-header",children:e.jsx("h2",{className:"neu-title",children:"ðŸ“ Create Budget"})}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault(),R(!0);try{await fe({name:$,period_type:H,start_date:O,end_date:Y,notes:U}),q(""),V(""),W("2025-01-01"),z("2025-01-31"),await(async function(){k(!0);const a=await de();i(a),k(!1)})()}catch(s){console.error(s),p("Failed to create budget")}finally{R(!1)}},className:"neu-form",children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"sm:col-span-2 neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{id:"budget_name",value:$,onChange:t=>q(t.target.value),placeholder:" ",required:!0}),e.jsx("label",{htmlFor:"budget_name",children:"e.g., January 2025, Q1 Budget"}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]})})]})}),e.jsxs("div",{className:"neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Period Type"}),e.jsxs("select",{value:H,onChange:t=>ie(t.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",children:[e.jsx("option",{value:"MONTHLY",children:"Monthly"}),e.jsx("option",{value:"ANNUAL",children:"Annual"}),e.jsx("option",{value:"CUSTOM",children:"Custom"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{type:"date",id:"budget_start",value:O,onChange:t=>W(t.target.value),placeholder:" "}),e.jsx("label",{htmlFor:"budget_start",children:"Start Date"}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})})]})}),e.jsx("div",{className:"neu-form-group",children:e.jsxs("div",{className:"neu-input",children:[e.jsx("input",{type:"date",id:"budget_end",value:Y,onChange:t=>z(t.target.value),placeholder:" "}),e.jsx("label",{htmlFor:"budget_end",children:"End Date"}),e.jsx("div",{className:"neu-input-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})})]})})]}),e.jsxs("div",{className:"mt-4 neu-form-group",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes (optional)"}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",value:U,onChange:t=>V(t.target.value),placeholder:"Add any additional notes...",rows:3})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-subtle)]",children:e.jsx("button",{type:"submit",disabled:D,className:"neu-button disabled:opacity-60",children:D?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"neu-spinner"}),e.jsx("span",{children:"Creatingâ€¦"})]}):"Create Budget"})})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-amber-50/50 to-yellow-50/50 dark:from-amber-900/10 dark:to-yellow-900/10 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Smart Budgeting Tips"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Expert advice for better financial planning"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs(I,{to:"/blog/budgeting-50-30-20-rule",className:"flex gap-2 hover:bg-white/50 dark:hover:bg-gray-800/50 p-2 rounded-lg transition-colors group",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"â€¢"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"50/30/20 Rule:"})," Allocate 50% to needs, 30% to wants, and 20% to savings."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]}),e.jsxs(I,{to:"/blog/zero-based-budgeting",className:"flex gap-2 hover:bg-white/50 dark:hover:bg-gray-800/50 p-2 rounded-lg transition-colors group",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-bold",children:"â€¢"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Zero-Based Budgeting:"})," Give every shilling a purpose by planning where each one goes."]}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"Read full guide â†’"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:"â€¢"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Review Monthly:"})," Check your budgets regularly and adjust based on actual spending patterns."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-bold",children:"â€¢"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Emergency Fund First:"})," Build a buffer of 3-6 months of expenses before aggressive investing."]})]})]}),e.jsx(I,{to:"/blog",className:"mt-4 pt-4 border-t border-amber-200 dark:border-amber-800 block text-center text-sm font-semibold text-blue-600 hover:text-blue-700",children:"View All Financial Tips â†’"})]})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[l&&e.jsxs("div",{className:"card animate-slide-in",children:[e.jsxs("div",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"âž•"}),"Add Budget Line"]}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault();try{await ye({budget:l,category:K,planned_amount:Number(ee)}),X(""),te("0");const[s,a]=await Promise.all([v(l),_(l)]);h(s),N(a)}catch(s){console.error(s),p("Failed to create budget line")}},children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category *"}),e.jsxs("select",{value:K,onChange:t=>X(t.target.value?Number(t.target.value):""),className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",required:!0,children:[e.jsx("option",{value:"",children:"â€” select category â€”"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.kind,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Planned Amount *"}),e.jsx("input",{type:"number",step:"0.01",value:ee,onChange:t=>te(t.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3.5 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200 placeholder:text-gray-400",required:!0})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:"btn-primary disabled:opacity-60",children:"Add Line"})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border-subtle)]",children:[e.jsxs("div",{className:"text-sm font-semibold mb-3 text-[var(--text-muted)] uppercase tracking-wide",children:["Budget Lines ",c.length>0&&`(${c.length})`]}),c.length===0&&e.jsxs("div",{className:"text-center py-8 text-[var(--text-muted)]",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“‹"}),e.jsx("p",{className:"text-sm",children:"No lines for this budget yet"})]}),c.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[var(--surface)] sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Planned"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border-subtle)]",children:c.map(t=>{const s=oe===t.id;return e.jsxs("tr",{className:"hover:bg-[var(--surface)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:s?e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:G,onChange:a=>J(a.target.value?Number(a.target.value):""),children:[e.jsx("option",{value:"",children:"â€” select category â€”"}),w.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.kind,")"]},a.id))]}):e.jsx("span",{className:"font-medium",children:t.category_name})}),e.jsx("td",{className:"px-4 py-3 text-right",children:s?e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 text-base bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all duration-200",value:Q,onChange:a=>Z(a.target.value)}):e.jsx("span",{className:"font-semibold",children:m(t.planned_amount)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:s?e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"btn-primary text-xs px-3 py-1.5 rounded",onClick:async()=>{try{await je(t.id,{category:G,planned_amount:Number(Q)}),E(null);const[a,u]=await Promise.all([v(l),_(l)]);h(a),N(u)}catch(a){console.error(a),p("Failed to update line")}},children:"Save"}),e.jsx("button",{className:"btn-secondary text-xs px-3 py-1.5 rounded",onClick:()=>E(null),children:"Cancel"})]}):e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"btn-edit text-xs px-3 py-1.5 rounded inline-flex items-center gap-1",onClick:()=>{E(t.id),J(t.category),Z(String(t.planned_amount))},children:"Edit"}),e.jsx("button",{className:"btn-delete text-xs px-3 py-1.5 rounded inline-flex items-center gap-1",onClick:async()=>{if(confirm("Delete this budget line?"))try{await Ne(t.id);const[a,u]=await Promise.all([v(l),_(l)]);h(a),N(u)}catch(a){console.error(a),p("Failed to delete line")}},children:"Delete"})]})})]},t.id)})})]})})]})]}),!ae&&n.length===0&&e.jsxs("div",{className:"card text-center py-16",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ’°"}),e.jsx("p",{className:"text-lg mb-2 font-medium",children:"No budgets yet"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Create your first budget above to start tracking"})]}),n.length>0&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"}),"Your Budgets"]}),e.jsx("ul",{className:"space-y-2",children:n.map(t=>{const s=t.id===l;return e.jsx("li",{children:e.jsxs("button",{className:"w-full text-left px-4 py-3 rounded-lg text-sm transition-all "+(s?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"bg-[var(--surface)] hover:bg-[var(--surface-hover)] hover:shadow-md"),onClick:()=>se(t.id),children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsxs("div",{className:`text-xs mt-1 ${s?"text-white/80":"text-[var(--text-muted)]"}`,children:[t.start_date," â†’ ",t.end_date]})]})},t.id)})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[L&&e.jsx("div",{className:"skeleton h-64 rounded"}),!L&&o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:(d??o)?.budget.name}),e.jsxs("div",{className:"text-sm text-[var(--text-muted)]",children:[(d??o)?.budget.start_date," â†’ ",(d??o)?.budget.end_date]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{onChange:t=>{ne(t.startDate),le(t.endDate)},initialStart:b??void 0,initialEnd:f??void 0}),b&&f&&e.jsx("button",{className:"btn-secondary text-xs px-3 py-2",onClick:()=>{ne(null),le(null),A(null)},children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[var(--surface)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Planned"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Actual"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Difference"})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--border-subtle)]",children:(d?d.lines:o.lines).map(t=>e.jsxs("tr",{className:"hover:bg-[var(--surface)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:t.category_name}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:m(t.planned)}),e.jsx("td",{className:"px-4 py-3 text-right",children:m(t.actual)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold "+(Number(t.difference)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:m(t.difference)})]},t.category_id))}),e.jsx("tfoot",{className:"bg-[var(--surface)] border-t-2 border-[var(--border-subtle)]",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"px-4 py-4",children:"Total"}),e.jsx("td",{className:"px-4 py-4 text-right",children:m(d?d.totals.planned:o.totals.planned)}),e.jsx("td",{className:"px-4 py-4 text-right",children:m(d?d.totals.actual:o.totals.actual)}),e.jsx("td",{className:"px-4 py-4 text-right text-lg "+(Number(d?d.totals.difference:o.totals.difference)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:m(d?d.totals.difference:o.totals.difference)})]})})]})})]}),!L&&!o&&e.jsxs("div",{className:"text-center py-16 text-[var(--text-muted)]",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ“‹"}),e.jsx("p",{className:"text-lg mb-2 font-medium",children:"Select a budget"}),e.jsx("p",{className:"text-sm",children:"Choose a budget from the list to view its summary"})]})]})})]})]})]})]})}export{Se as default};
